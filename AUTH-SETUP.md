# إعداد نظام المصادقة والصلاحيات

## المتطلبات الأساسية

1. Node.js (الإصدار 16 أو أحدث)
2. npm أو yarn
3. مشروع Supabase

## إعداد متغيرات البيئة

1. انسخ ملف `.env.example` إلى `.env`
2. قم بتعبئة المتغيرات التالية:

```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key
```

## إنشاء أول مستخدم مدير (Admin)

1. قم بتشغيل سكريبت إنشاء المدير:

```bash
# تثبيت التبعيات المطلوبة
npm install @supabase/supabase-js dotenv

# تشغيل السكريبت
npx ts-node scripts/create-admin.ts
```

2. اتبع التعليمات لإدخال:
   - البريد الإلكتروني للمدير
   - كلمة المرور (8 أحرف على الأقل)
   - الاسم الكامل

3. بعد اكتمال العملية، ستحصل على تأكيد بإنشاء الحساب مع رابط لوحة التحكم.

## تسجيل الدخول

1. انتقل إلى صفحة تسجيل الدخول: http://localhost:8080/login
2. أدخل بيانات الاعتماد التي أدخلتها في الخطوة السابقة
3. سيتم توجيهك إلى لوحة التحكم المناسبة بناءً على دورك

## الصلاحيات المتاحة

### 1. المدير (Admin)
- الوصول الكامل إلى لوحة تحكم المدير
- إدارة جميع الطلبات والمستخدمين
- تعيين أدوار المستخدمين

### 2. الفني (Technician)
- عرض الطلبات المخصصة له
- تحديث حالة الطلبات
- إضافة ملاحظات على الطلبات

### 3. المستخدم العادي (User)
- إنشاء طلبات جديدة
- تتبع حالة الطلبات الخاصة به

## استكشاف الأخطاء وإصلاحها

### مشكلة: لا يمكن تسجيل الدخول
- تحقق من صحة بيانات الاعتماد
- تأكد من تفعيل البريد الإلكتروني (إذا كان الإعداد يتطلب تأكيد البريد)
- تحقق من سجلات الأخطاء في وحدة تحكم المتصاج

### مشكلة: لا تظهر جميع الصلاحيات
- تأكد من أن المستخدم لديه الدور الصحيح في جدول `profiles`
- تأكد من إعادة تسجيل الدخول بعد تغيير الصلاحيات

## الأمان

- لا تشارك مفتاح `SUPABASE_SERVICE_ROLE_KEY` مع أي شخص
- استخدم كلمات مرور قوية للمستخدمين
- قم بتحديث التبعيات بانتظام

## تحديثات مستقبلية

- إضافة التحقق بخطوتين (2FA)
- إدارة الصلاحيات المتقدمة
- سجلات التدقيق لأنشطة المستخدمين
